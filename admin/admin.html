<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - License Management</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- EmailJS SDK -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>Admin Panel - Registration Management</h1>
                <p class="subtitle">Qu·∫£n l√Ω ƒëƒÉng k√Ω v√† duy·ªát license cho kh√°ch h√†ng</p>
            </div>
        </header>

        <nav class="admin-nav">
            <div class="nav-content">
                <a href="../index.html" class="nav-link">‚Üê Quay v·ªÅ trang ch√≠nh</a>
                <div class="nav-stats">
                    <span id="totalRegistrations" class="stat-item">0 ƒëƒÉng k√Ω</span>
                    <span id="pendingRegistrations" class="stat-item">0 ch·ªù duy·ªát</span>
                    <span id="approvedRegistrations" class="stat-item">0 ƒë√£ duy·ªát</span>
                    <span id="rejectedRegistrations" class="stat-item">0 ƒë√£ t·ª´ ch·ªëi</span>
                    <span id="suspendedRegistrations" class="stat-item">0 t·∫°m d·ª´ng</span>
                </div>
            </div>
        </nav>

        <main class="admin-main">
            <div class="admin-container">
                <!-- Controls -->
                <div class="admin-controls">
                    <div class="control-group">
                        <h2>B·ªô l·ªçc v√† t√¨m ki·∫øm</h2>
                        <div class="controls-row">
                            <input type="text" id="searchInput" placeholder="T√¨m ki·∫øm theo t√™n, email, license key...">
                            <select id="statusFilter">
                                <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                                <option value="Pending">Ch·ªù duy·ªát</option>
                                <option value="Approved">ƒê√£ duy·ªát</option>
                                <option value="Rejected">T·ª´ ch·ªëi</option>
                                <option value="Suspended">T·∫°m d·ª´ng</option>
                            </select>
                            <button id="refreshBtn" class="btn btn-secondary">L√†m m·ªõi</button>
                            <button id="exportBtn" class="btn btn-primary">Xu·∫•t Excel</button>
                            <button id="testEmailBtn" class="btn btn-secondary">Test Email</button>
                        </div>
                    </div>
                </div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">üìä</div>
                        <div class="stat-info">
                            <h3 id="totalCount">0</h3>
                            <p>T·ªïng ƒëƒÉng k√Ω</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è∞</div>
                        <div class="stat-info">
                            <h3 id="pendingCount">0</h3>
                            <p>Ch·ªù duy·ªát</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚úÖ</div>
                        <div class="stat-info">
                            <h3 id="approvedCount">0</h3>
                            <p>ƒê√£ duy·ªát</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚õî</div>
                        <div class="stat-info">
                            <h3 id="suspendedCount">0</h3>
                            <p>T·∫°m d·ª´ng</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üìÖ</div>
                        <div class="stat-info">
                            <h3 id="todayRegistrations">0</h3>
                            <p>ƒêƒÉng k√Ω h√¥m nay</p>
                        </div>
                    </div>
                </div>

                <!-- License Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h2>Danh s√°ch ƒêƒÉng k√Ω</h2>
                        <div class="table-actions">
                            <button id="approveSelectedBtn" class="btn btn-success btn-sm">Duy·ªát ƒë√£ ch·ªçn</button>
                            <button id="rejectSelectedBtn" class="btn btn-danger btn-sm">T·ª´ ch·ªëi ƒë√£ ch·ªçn</button>
                            <button id="suspendSelectedBtn" class="btn btn-warning btn-sm">T·∫°m d·ª´ng ƒë√£ ch·ªçn</button>
                        </div>
                    </div>
                    
                    <div class="table-wrapper">
                        <table id="registrationsTable" class="admin-table">
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAll"></th>
                                    <th>M√£ ƒëƒÉng k√Ω</th>
                                    <th>Ng∆∞·ªùi d√πng</th>
                                    <th>Email</th>
                                    <th>S·ªë ƒëi·ªán tho·∫°i</th>
                                    <th>C√¥ng ty</th>
                                    <th>License Key</th>
                                    <th>S·ªë m√°y</th>
                                    <th>Ng√†y ƒëƒÉng k√Ω</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>H√†nh ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody id="registrationsTableBody">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>

                    <div id="emptyState" class="empty-state" style="display: none;">
                        <div class="empty-icon">üìÑ</div>
                        <h3>Ch∆∞a c√≥ ƒëƒÉng k√Ω n√†o</h3>
                        <p>Ch∆∞a c√≥ ƒëƒÉng k√Ω n√†o trong h·ªá th·ªëng.</p>
                        <a href="../index.html" class="btn btn-primary">T·∫°o ƒëƒÉng k√Ω ƒë·∫ßu ti√™n</a>
                    </div>
                </div>

                <!-- Pagination -->
                <div id="pagination" class="pagination" style="display: none;">
                    <button id="prevPage" class="btn btn-sm">‚Üê Tr∆∞·ªõc</button>
                    <span id="pageInfo">Trang <span id="currentPage">1</span> / <span id="totalPages">1</span></span>
                    <button id="nextPage" class="btn btn-sm">Sau ‚Üí</button>
                </div>
            </div>
        </main>
    </div>

    <!-- License Detail Modal -->
    <div id="licenseDetailModal" class="modal" style="display: none;">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Chi ti·∫øt License</h3>
                <span class="close" onclick="closeLicenseDetailModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div id="licenseDetailContent"></div>
            </div>
            <div class="modal-footer">
                <button onclick="closeLicenseDetailModal()" class="btn btn-secondary">ƒê√≥ng</button>
                <button id="editLicenseBtn" class="btn btn-primary">Ch·ªânh s·ª≠a</button>
            </div>
        </div>
    </div>

    <!-- Edit License Modal -->
    <div id="editLicenseModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ch·ªânh s·ª≠a License</h3>
                <span class="close" onclick="closeEditLicenseModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editLicenseForm">
                    <input type="hidden" id="editLicenseIndex">
                    <div class="form-group">
                        <label>T√™n ng∆∞·ªùi d√πng:</label>
                        <input type="text" id="editUserName" required>
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="editEmail" required>
                    </div>
                    <div class="form-group">
                        <label>C√¥ng ty:</label>
                        <input type="text" id="editCompany">
                    </div>
                    <div class="form-group">
                        <label>Tr·∫°ng th√°i:</label>
                        <select id="editStatus">
                            <option value="Active">Active</option>
                            <option value="Suspended">Suspended</option>
                            <option value="Expired">Expired</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="closeEditLicenseModal()" class="btn btn-secondary">H·ªßy</button>
                <button onclick="saveLicenseChanges()" class="btn btn-primary">L∆∞u thay ƒë·ªïi</button>
            </div>
        </div>
    </div>

    <!-- View Registration Modal -->
    <div id="viewRegistrationModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Chi ti·∫øt ƒëƒÉng k√Ω</h3>
                <span class="close" onclick="closeViewRegistrationModal()">&times;</span>
            </div>
            <div class="modal-body">
                <table class="modal-table">
                    <tr>
                        <td><strong>M√£ ƒëƒÉng k√Ω:</strong></td>
                        <td id="viewRegistrationId"></td>
                    </tr>
                    <tr>
                        <td><strong>T√™n ng∆∞·ªùi d√πng:</strong></td>
                        <td id="viewUserName"></td>
                    </tr>
                    <tr>
                        <td><strong>Email:</strong></td>
                        <td id="viewEmail"></td>
                    </tr>
                    <tr>
                        <td><strong>S·ªë ƒëi·ªán tho·∫°i:</strong></td>
                        <td id="viewPhone"></td>
                    </tr>
                    <tr>
                        <td><strong>C√¥ng ty:</strong></td>
                        <td id="viewCompany"></td>
                    </tr>
                    <tr>
                        <td><strong>Machine ID:</strong></td>
                        <td id="viewMachineId"></td>
                    </tr>
                    <tr>
                        <td><strong>Ng√†y ƒëƒÉng k√Ω:</strong></td>
                        <td id="viewRegisteredAt"></td>
                    </tr>
                    <tr>
                        <td><strong>S·ªë ti·ªÅn:</strong></td>
                        <td id="viewPaymentAmount"></td>
                    </tr>
                    <tr>
                        <td><strong>Tr·∫°ng th√°i:</strong></td>
                        <td id="viewStatus"></td>
                    </tr>
                    <tr id="viewLicenseKeyRow" style="display: none;">
                        <td><strong>License Key:</strong></td>
                        <td id="viewLicenseKey" class="license-key"></td>
                    </tr>
                </table>
            </div>
            <div class="modal-footer">
                <button onclick="closeViewRegistrationModal()" class="btn btn-secondary">ƒê√≥ng</button>
            </div>
        </div>
    </div>

    <!-- Suspend License Modal -->
    <div id="suspendModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>T·∫°m d·ª´ng License</h3>
                <span class="close" onclick="closeSuspendModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="suspendForm">
                    <input type="hidden" id="suspendRegistrationId">
                    <div class="form-group">
                        <label>Email kh√°ch h√†ng:</label>
                        <input type="email" id="suspendEmail" readonly>
                    </div>
                    <div class="form-group">
                        <label>License Key:</label>
                        <input type="text" id="suspendLicenseKey" readonly>
                    </div>
                    <div class="form-group">
                        <label>S·ªë m√°y hi·ªán t·∫°i:</label>
                        <input type="number" id="suspendMachineCount" readonly>
                    </div>
                    <div class="form-group">
                        <label>L√Ω do t·∫°m d·ª´ng:</label>
                        <select id="suspendReason" required>
                            <option value="">Ch·ªçn l√Ω do</option>
                            <option value="multiple_machines">S·ª≠ d·ª•ng tr√™n nhi·ªÅu m√°y t√≠nh</option>
                            <option value="suspicious_activity">Ho·∫°t ƒë·ªông ƒë√°ng nghi</option>
                            <option value="payment_issue">V·∫•n ƒë·ªÅ thanh to√°n</option>
                            <option value="violation">Vi ph·∫°m ƒëi·ªÅu kho·∫£n</option>
                            <option value="other">Kh√°c</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Chi ti·∫øt:</label>
                        <textarea id="suspendDetail" rows="4" placeholder="M√¥ t·∫£ chi ti·∫øt l√Ω do t·∫°m d·ª´ng..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button onclick="closeSuspendModal()" class="btn btn-secondary">H·ªßy</button>
                <button onclick="confirmSuspendLicense()" class="btn btn-warning">T·∫°m d·ª´ng License</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="confirmTitle">X√°c nh·∫≠n</h3>
                <span class="close" onclick="closeConfirmModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmMessage"></p>
            </div>
            <div class="modal-footer">
                <button onclick="closeConfirmModal()" class="btn btn-secondary">H·ªßy</button>
                <button id="confirmActionBtn" class="btn btn-danger">X√°c nh·∫≠n</button>
            </div>
        </div>
    </div>

    <script src="admin.js"></script>
</body>
</html>